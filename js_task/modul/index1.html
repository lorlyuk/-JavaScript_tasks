<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"/>  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="css/style.css"/>
  <title>JS Task 1</title>
</head>
<body>
	<nav>
    <div class="title">
   <h1>Дані по навчанню студентів трьох груп Національного Університету</h1> 
    </div>
     
    <div class="col-md-12 searchByName">
      <div class="form-group">
        <label>Пошук по імені</label>
        <input type="text" name="" id="name">
        <button type="submit" onclick="academy.displayStudent()">Шукати</button>
      </div>
    </div>
    <div class="col-md-12 searchByGroup">
      <div class="form-group">
        <label>Пошук по групі</label>
        <input type="text" name="" id="group">
        <button type="submit" onclick="academy.displayGroup()">Шукати</button>
      </div>
    </div> 
    <div class="col-md-12 button_down">
          <button onclick="academy.displayGeneralGroupStat()">Загальна стастика</button>
        </div>
  </nav>
  <main>
    <div class="container">
      <div class="row">
        <div id="ResultDisplay"></div>
      </div>
    </div>
  </main>
 <script type="text/javascript">
 var academy = (function (){
 var students = [
    {
       firstName: "Андрій", 
      secondName: "Іванов", 
       groupName: "1", 
       subject: [ 
            {
              name: "biology",    
              marks: ["нб",2,5,8,7,5,6,0,5,0]
            },
            {
             name: "english",
             marks: [0,2,5,8,7,5,6,"нб",5,0]
            },
            { 
              name: " music" ,
              marks:["нб",2,5,8,"нб",5,6,"нб",5,0]
            },
            {
              name: "chemistry",
              marks: ["нб",2,5,8,7,5,6,"нб",5,0]
            },
            {
              name: "physics",
              marks: ["нб",2,5,8,7,5,6,"нб",5,0]
            }
            ]
    },
    {
     firstName: "Василь", 
    secondName: "Баранов", 
     groupName: "1", 
       subject: [ 
            {
                name: "biology",    
                marks: ["нб",2,5,8,7,5,6,0,5,0]
            },
            {
                name: "english",
                marks: [0,2,5,8,7,5,6,"нб",5,0]
            },
            {   name: " music" ,
                marks:["нб",2,5,8,"нб",5,6,"нб",5,0]
            },
            {
                 name: "chemistry",
                 marks: ["нб",2,5,8,7,5,6,"нб",5,0]
            },
            {
                name: "physics",
                marks: ["нб",2,5,8,7,5,6,"нб",5,0]
            }
            ]
    },
    {
     firstName: "Петро", 
    secondName: "Гриб", 
     groupName: "1", 
        subject: [ 
              {
                  name: "biology",    
                  marks: ["нб",2,5,8,7,5,6,0,5,0]
              },
              {
                  name: "english",
                  marks: [6,6,6,6,6,6,6,"нб",6,6]
              },
              {   name: " music" ,
                  marks:["нб",2,5,8,"нб",5,6,"нб",5,0]
              },
              {
                   name: "chemistry",
                   marks: ["нб",2,5,8,7,5,6,"нб",5,0]
              },
              {
                  name: "physics",
                  marks: ["нб",2,5,8,7,5,6,"нб",5,0]
              }
              ]
          },
     {
     firstName: "Боб", 
    secondName: "Лис", 
     groupName: "1", 
       subject: [ 
              {
                  name: "biology",    
                  marks: ["нб",2,5,8,7,5,6,0,5,9]
              },
              {
                  name: "english",
                  marks: [0,2,5,8,7,5,6,"нб",5,0]
              },
              {   name: " music" ,
                  marks:["нб",2,5,8,"нб",5,6,"нб",5,0]
              },
              {
                   name: "chemistry",
                   marks: ["нб",2,5,8,7,5,6,"нб",5,0]
              },
              {
                  name: "physics",
                  marks: ["нб",2,5,8,7,5,6,"нб",5,0]
              }
              ]
          },
     {
     firstName: "Антоніна", 
    secondName: "Вовк", 
     groupName: "1", 
       subject: [ 
              {
                  name: "biology",    
                  marks: ["нб",2,5,8,7,5,6,0,5,0]
              },
              {
                  name: "english",
                  marks: [0,2,5,8,7,5,6,"нб",5,0]
              },
              {   name: " music" ,
                  marks:["нб",2,5,8,"нб",5,6,"нб",5,0]
              },
              {
                   name: "chemistry",
                   marks: ["нб",2,5,8,7,5,6,"нб",5,0]
              },
              {
                  name: "physics",
                  marks: ["нб",2,5,8,7,5,6,"нб",5,0]
              }
              ]
          },
     {
     firstName: "Євген", 
    secondName: "Бук", 
     groupName: "2", 
       subject: [ 
              {
                  name: "biology",    
                  marks: ["нб",2,5,8,7,5,6,0,5,0]
              },
              {
                  name: "english",
                  marks: [0,2,5,8,7,5,6,"нб",5,0]
              },
              {   name: " music" ,
                  marks:["нб",2,5,8,"нб",5,6,"нб",5,0]
              },
              {
                   name: "chemistry",
                   marks: ["нб",2,5,8,7,5,6,"нб",5,0]
              },
              {
                  name: "physics",
                  marks: ["нб",2,5,8,7,5,6,"нб",5,0]
              }
              ]
          },
   {
     firstName: "Катерина", 
    secondName: "Паук", 
     groupName: "2", 
       subject: [ 
              {
                  name: "biology",    
                  marks: ["нб",2,5,8,7,5,6,0,5,9]
              },
              {
                  name: "english",
                  marks: [9,2,5,8,7,5,6,"нб",5,9]
              },
              {   name: " music" ,
                  marks:["нб",2,5,8,"нб",5,6,"нб",5,9]
              },
              {
                   name: "chemistry",
                   marks: ["нб",2,5,8,7,5,6,"нб",5,9]
              },
              {
                  name: "physics",
                  marks: ["нб",2,5,8,7,5,6,"нб",5,0]
              }
              ]
    },
    {
     firstName: "Алла", 
    secondName: "Грибюк", 
     groupName: "2", 
        subject: [ 
              {
                  name: "biology",    
                  marks: ["нб",2,5,8,7,5,6,0,5,0]
              },
              {
                  name: "english",
                  marks: [0,2,5,8,7,5,6,"нб",5,0]
              },
              {   name: " music" ,
                  marks:["нб",2,5,8,"нб",5,6,"нб",5,0]
              },
              {
                   name: "chemistry",
                   marks: ["нб",2,5,8,7,5,6,"нб",5,5]
              },
              {
                  name: "physics",
                  marks: ["нб",2,5,8,7,5,6,"нб",5,0]
              }
              ]
   },
    {
     firstName: "Іван", 
    secondName: "Лисковець", 
     groupName: "2", 
      subject: [ 
            {
                name: "biology",    
                marks: ["нб",2,5,8,7,5,6,5,5,0]
            },
            {
                name: "english",
                marks: [0,2,5,8,7,5,6,"нб",5,0]
            },
            {   name: " music" ,
                marks:["нб",2,5,8,"нб",5,6,"нб",5,0]
            },
            {
                 name: "chemistry",
                 marks: ["нб",2,5,8,7,5,6,"нб",5,0]
            },
            {
                name: "physics",
                marks: ["нб",2,5,8,7,5,6,"нб",5,5]
            }
    ]
   },
   {
     firstName: "Макар", 
    secondName: "Вовкович", 
     groupName: "2", 
        subject: [ 
            {
                name: "biology",    
                marks: ["нб",2,5,8,7,5,6,4,5,0]
            },
            {
                name: "english",
                marks: [0,2,5,8,7,5,6,"нб",5,4]
            },
            {   name: " music" ,
                marks:["нб",2,5,8,"нб",5,6,"нб",5,4]
            },
            {
                 name: "chemistry",
                 marks: ["нб",2,5,8,7,5,6,"нб",5,0]
            },
            {
                name: "physics",
                marks: ["нб",2,5,8,7,5,6,"нб",5,4]
            }
            ]
    },
    {
     firstName: "Анатолій", 
    secondName: "Петров", 
     groupName: "3", 
       subject: [ 
    {
                name: "biology",    
                marks: ["нб",2,5,8,7,5,6,0,5,0]
            },
            {
                name: "english",
                marks: [0,2,5,8,7,5,6,"нб",5,0]
            },
            {   name: " music" ,
                marks:["нб",2,5,8,"нб",5,6,"нб",5,0]
            },
            {
                 name: "chemistry",
                 marks: ["нб",2,5,8,7,5,6,"нб",5,0]
            },
            {
                name: "physics",
                marks: ["нб",2,5,8,7,5,6,"нб",5,0]
            }
            ]
    },
     {
     firstName: "Григорій", 
    secondName: "Акулов", 
     groupName: "3", 
        subject: [ 
            {
                name: "biology",    
                marks: ["нб",2,5,8,7,5,6,3,5,3]
            },
            {
                name: "english",
                marks: [0,2,5,8,7,5,6,"нб",5,3]
            },
            {   name: " music" ,
                marks:["нб",2,5,8,"нб",5,6,"нб",5,0]
            },
            {
                 name: "chemistry",
                 marks: ["нб",2,5,8,7,5,6,"нб",5,0]
            },
            {
                name: "physics",
                marks: ["нб",2,5,8,7,5,6,"нб",5,0]
            }
            ]
    },
     {
     firstName: "Олена", 
    secondName: "Грибеневич", 
     groupName: "3", 
        subject: [ 
              {
                  name: "biology",    
                  marks: ["нб",2,5,8,7,5,6,0,5,]
              },
              {
                  name: "english",
                  marks: [0,2,5,8,7,5,6,"нб",5,0]
              },
              {   name: " music" ,
                  marks:["нб",2,5,8,"нб",5,6,"нб",5,0]
              },
              {
                   name: "chemistry",
                   marks: ["нб",2,5,8,7,5,6,"нб",5,0]
              },
              {
                  name: "physics",
                  marks: ["нб",2,5,8,7,5,6,"нб",5,0]
              }
              ]
    },
     {
     firstName: "Віталій", 
    secondName: "Лисака", 
     groupName: "3", 
        subject: [ 
              {
                  name: "biology",    
                  marks: ["нб",2,5,8,7,5,6,"нб",5,"нб"]
              },
              {
                  name: "english",
                  marks: ["нб",2,5,8,7,5,6,"нб",5,"нб"]
              },
              {   name: " music" ,
                  marks:["нб",2,5,8,"нб",5,6,"нб",5,"нб"]
              },
              {
                   name: "chemistry",
                   marks: ["нб",2,5,8,7,5,6,"нб",5,0]
              },
              {
                  name: "physics",
                  marks: ["нб",2,5,8,7,5,6,"нб",5,0]
              }
              ]
    },
     {
     firstName: "Михайло", 
    secondName: "Вовкулака", 
     groupName: "3", 
       subject: [ 
            {
                name: "biology",    
                marks: ["нб",2,5,8,7,5,6,0,5,0]
            },
            {
                name: "english",
                marks: [0,2,5,8,7,5,6,"нб",5,0]
            },
            {   name: " music" ,
                marks:["нб",2,5,8,"нб",5,6,"нб",5,0]
            },
            {
                 name: "chemistry",
                 marks: ["нб",2,5,8,7,5,6,"нб",5,0]
            },
            {
                name: "physics",
                marks: ["нб",2,5,8,7,5,6,"нб",5,0]
            },
            ]
    }
];
var searchByName = function(name) {
    var result = [];
    for (var i = 0; i < students.length; ++i) {
        if (students [i].secondName == name) {
           result.push(students [i]);
       }

    }
    return result;
   }

    
function displayStudent() {
    var name = $('#name').val();
    if (name) {
      var resultByStudent = searchByName(name);
    }

    var result = '';
    var total = '';
    var sum = 0;
    var n = 0;
    var avgScore = 0;
    var avgGeneral = 0;
    var nGeneral = 0;

    for (var i = 0; i < resultByStudent.length; ++i) {
      
             result += '<h2>' + resultByStudent[i].firstName + " " + resultByStudent[i].secondName  + '</h2><div class="table-responsive"><table class="table">' + 
          '<thead><tr><th>Предмет</th><th colspan="10">Оцінки</th><th colspan="1">Середній бал</th><th colspan="1">К-сть пропусків</th></thead>' + 
          '<tbody>'
      
      for (var j = 0; j < resultByStudent[i].subject.length; ++j) {
        result += '<tr><td>' + resultByStudent[i].subject[j].name + '</td>';

        for (var k = 0; k < resultByStudent[i].subject[j].marks.length; ++k) {
          result += '<td>' + resultByStudent[i].subject[j].marks[k] + '</td>';

          if (resultByStudent[i].subject[j].marks[k] == 'нб') {
            n++;
          } else {
            sum += (resultByStudent[i].subject[j].marks[k]);
          }
        }
     
        avgScore = (sum / (k - n)).toFixed(2);
        result += '<td>' + avgScore + '</td><td>' + n + '</td></tr>';
        avgGeneral += (sum / (k-n));
        nGeneral += n;
        sum = 0;
        n = 0;
      
    
      }
      total = 'Середній бал: <b>' + (avgGeneral / j).toFixed(2) + '</b><br>К-сть пропусків: <b>' + nGeneral + '</b>';
      result += '</tbody></table>' + total + '</div>';
    }


    if (!result) {
      result = 'Вибачте. Такого студента не знайдено.'
    }     

  $('#ResultDisplay').html(result);
  }

var searchByGroup = function (groupName) {
 var groupName = $('#group').val();
    if (groupName) {
      var resultByStudent = searchByName(name);
    }

    var result = [];
      for (var i = 0; i < students.length; ++i){
        if (students[i].groupName == groupName){
             result.push(students[i]);
            } 
        }
      return result;

  };

  function displayGroup (groupName) {

    var groupName = $('#group').val();
    if (groupName) {
      var resultByGroup = searchByGroup(groupName);
    }

    
    
    var result = '<h1>' + groupName + '</h1>';
    var sum = 0;
    var n = 0;
    var avgScore = 0;
    var avgGeneralStudent = 0;
    var nGeneralStudent = 0;
    var nGeneralGroup = 0;
    var avgGeneralGroup = 0;
    var sumOfSubjectsAllStudent = 0;
    for (var i = 0; i < resultByGroup.length; ++i) {

        result += '<h2>' + resultByGroup[i].firstName + " " + resultByGroup[i].secondName+ '</h2><div class="table-responsive"><table class="table">' + 
        '<thead><tr><th>Предмет</th><th colspan="10">Оцінки</th><th colspan="1">Середній бал</th><th colspan="1">К-сть пропусків</th></thead>' + 
        '<tbody>'

        for (var j = 0; j < resultByGroup[i].subject.length; ++j) {
          result += '<tr><td>' + resultByGroup[i].subject[j].name + '</td>';

          for (var k = 0; k < resultByGroup[i].subject[j].marks.length; ++k) {
            result += '<td>' + resultByGroup[i].subject[j].marks[k] + '</td>';

            if (resultByGroup[i].subject[j].marks[k] == 'нб') {
              n++;
            } else {
              sum += (resultByGroup[i].subject[j].marks[k]);
            }
          }
          avgScore = (sum / (k - n)).toFixed(2);
          result += '<td>' + avgScore + '</td><td>' + n + '</td></tr>';
          avgGeneralStudent += (sum / (k-n));
          nGeneralStudent += n;
          sum = 0;
          n = 0;
      }
      total = 'Середній бал: <b>' + (avgGeneralStudent / j).toFixed(2) + '</b><br>К-сть пропусків: <b>' + nGeneralStudent + '</b>';
      result += '</tbody></table>' + total + '</div>';
      nGeneralGroup += nGeneralStudent;
      avgGeneralGroup += avgGeneralStudent;
      nGeneralStudent = 0;
      avgGeneralStudent = 0; 
    }
    sumOfSubjectsAllStudent = i * j;
    avgGeneralGroup = (avgGeneralGroup / sumOfSubjectsAllStudent).toFixed(2);
    result += '<div class="statOfGroup">К-сть пропусків в групі: <b>' + nGeneralGroup + '</b><br>Середній бал групи: <b>' + avgGeneralGroup + '</b></div>'

    if (!result) {
      result = 'Вибачте. Такої групи не знайдено.'
    }   
    $('#ResultDisplay').html(result);
    }


    var getAll = function () {
    var result = [];
    for (var i = 0; i < students.length; ++i) {
           result.push(students[i]);
      }
        return result;
  }

  function displayGeneralGroupStat () {
    var resultByAll = getAll();
    var result = [];
    var sum = 0;
    var n = 0;
    var avgScore = 0;
    
    for (var i = 0; i < resultByAll.length; ++i) {
        for (var j = 0; j < resultByAll[i].subject.length; ++j) {
          for (var k = 0; k < resultByAll[i].subject[j].marks.length; ++k) {
            if (resultByAll[i].subject[j].marks[k] == 'нб') {
              n++;
            } else {
              sum += (resultByAll[i].subject[j].marks[k]);
            }
          }
      }
    }
    avgScore = (sum / (k*j*i - n)).toFixed(2);
    result += '<h1>Статистика по всіх студентах</h1><div class="statOfGroup">К-сть пропусків: <b>' + n + '</b><br>Середній бал: <b>' + avgScore + '</b></div>'

    $('#ResultDisplay').html(result);
  }

  return {    
  searchByName : searchByName,
  displayStudent : displayStudent,
  searchByGroup :searchByGroup,
  displayGroup : displayGroup,
  getAll : getAll,
  displayGeneralGroupStat : displayGeneralGroupStat
  };

})();










/*


function search(){
  var res =[];
  var notres = "Sorry";
  var name = $('#name').val();
  var resultText  = "<tr>" + "<td>" + "<b>Номер групи</b>" + "</td>" + "<td>" + "<b>Прізвище</b>" + "</td>"+ "<td>" + "<b>Iмя студента</b>" + "</td>"+ "</tr>" 
     
  res = searchByName(name);
  
  for (var i = 0; i  < res.length; ++i){
  	   resultText += "<tr>" + "<td>" + res[i].groupName + "</td>" + "<td>" +  res[i].secondName + "</td>" + "<td>" + res[i].firstName +"</td>" + "<td>" + res[i].biology + "</td>" + "<td>" + res[i].english + "</td>" + "<td>" + res[i].music + "</td>" + "<td>" + res[i].chemistry + "</td>" + "<td>" + res[i].physics + "</td>" +"</tr>";
}
  $("table.foundTable").html(resultText);
};


function globalStatistic(){
			var res = academy.length;
			var sum = 0;
			var count = 0;
			var gS = "<h3>" + "Общая статистика" + "</h3>";

			for (var i = 0; i < academy.length; i++) {
				if (academy.res[i].rating != "нб") {
					sum += academy.res[i].rating;
					count += 1;
				}
				
			}
			sum = (sum / count).toFixed(2); //Середній бал по всім групам
			gS += "<p>" + "<b>Количество студентов: </b>" + res + " <b>средний бал составляет: </b>" + sum + "</p>"
			gS += "<div class='row'>";
			for (var j = 1; j <= 3; j++) {
				gS += "<div class='col-xs-12 col-sm-12 col-md-12 col-lg-12'><table class='statisticTable'><tr><td>Номер группы</td><td>Средний бал</td><td>Количество пропусков</td></tr>";
				count = 0;
				sum = 0;
				var sumOuts = 0, countRating = 0;
				for (var i = 0; i < academy.length; i++) {				
					if (academy.res[i].group == j) {						
						if (academy.res[i].rating != "нб"){
							sum += academy.res[i].rating;
							countRating++;
						} else {
							sumOuts++;
						}				
						
					}										
				}					
				sum = (sum / countRating).toFixed(2);
				gS += "<tr><td>" + j + "</td><td>" + sum + "</td><td>" + sumOuts + "</td></tr></table></div>";		
			}
			gS += "</div>";

			$("div.groupStatistic").html(gS);		
		}
		$(document).ready(function() {
			$("table.foundStudentsTable").hide();			
			$("a.click").click(function(){
				searchStudents();
				$(this).parent().find("table.foundStudentsTable").slideToggle();
			});
		});
		$(document).ready(function() {
			$("table.foundTable").hide();			
			$("a.clickFN").click(function(){
				search();
				$(this).parent().find("table.foundTable").slideToggle();
			});
		});
		$(document).ready(function() {
			$("div.groupStatistic").hide();			
			$("a.clickS").click(function(){
				globalStatistic();
				$(this).parent().find("div.groupStatistic").slideToggle();
			});
		});
return {
    searchByName : searchByName,
    searchByGroup : searchByGroup
     }; 
})();





/*
var countAvgMarkStudent = function(name) {
	var name = $('#name').val();
	var averageRatingSubject = "";
	var sumRating = 0;
    var result = '';
    var avgScore = 0;
res = academy.searchByName(name);
 for (var i = 0; i < res.length; i++) {
 	result += '<h1>' + res[i].secondName + '</h1><div class="table-responsive"><table class="table">' + 
					'<thead><tr><th>Предмет</th><th colspan="10">Оцінки</th><th colspan="1">Середній бал</th><th colspan="1">К-сть пропусків</th></thead>' + 
					'<tbody>'
 	for (var j = 0; j < res[i].music.length; j++){
 		result += '<td>' + res[i].music[j] + '</td>';
 		if (res[i].music[j]== "нб"){
 		n++;
 	} else {
 			sumRating += (res[i].music[j]);

 	}
	}
	
			

	$("#result").html(averageRatingSubject);
}*/

	</script>	
 </body>
 </html>